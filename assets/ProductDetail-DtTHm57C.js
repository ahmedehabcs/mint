import{r as f,R as e,g as _,h as B,i as V,j as J,k as U,l as H,u as Y,m as q,e as K,n as W}from"./index-Py7kvHa0.js";import{a as X}from"./products-DZsIXrs4.js";import{B as D}from"./Button-V8RViXZE.js";import{s as v}from"./toastHelper-Cmf0APRO.js";import{c as Z}from"./inputSanitizer-B2bR0dzU.js";import{i as C}from"./isofferActive-Bz0sscgL.js";const A=({product:a,currentImageIndex:o,setCurrentImageIndex:d})=>{const[s,r]=f.useState(!0),i=()=>{const u=o===0?a.images.length-1:o-1;d(u),r(!0)},l=()=>{const u=o===a.images.length-1?0:o+1;d(u),r(!0)},c=()=>{r(!1)},p=()=>{r(!1)};return e.createElement("div",{className:"space-y-4"},e.createElement("div",{className:"relative aspect-square overflow-hidden rounded-2xl bg-[var(--color-surface)] shadow-lg"},s&&e.createElement("div",{className:"absolute inset-0 flex items-center justify-center bg-[var(--color-surface)] z-10"},e.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--color-main)]"})),e.createElement("img",{src:a.images[o],alt:a.name,className:`w-full h-full object-cover transition-all duration-300 hover:scale-105 ${s?"opacity-0":"opacity-100"}`,onLoad:c,onError:p}),e.createElement("div",{className:"absolute top-4 left-4 bg-[var(--color-background)] text-[var(--color-text)] px-3 py-1 rounded-full text-sm font-medium shadow-md z-20"},a.category),a.images.length>1&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:i,className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-[var(--color-background)] bg-opacity-50 hover:bg-opacity-70 text-[var(--color-text)] p-2 rounded-full transition-all duration-200 z-20","aria-label":"Previous image"},e.createElement(_,{size:24})),e.createElement("button",{onClick:l,className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-[var(--color-background)] bg-opacity-50 hover:bg-opacity-70 text-[var(--color-text)] p-2 rounded-full transition-all duration-200 z-20","aria-label":"Next image"},e.createElement(B,{size:24}))),a.images.length>1&&e.createElement("div",{className:"absolute bottom-4 right-4 bg-[var(--color-background)] bg-opacity-50 text-[var(--color-text)] px-3 py-1 rounded-full text-sm font-medium z-20"},o+1," / ",a.images.length)))},Q=({product:a,selectedColor:o,selectedSize:d,getAvailableQuantity:s})=>{const r=C(a.price,a.offer,a.offerStartDate,a.offerEndDate),i=r?a.offer:a.price,l=r?Math.round((a.price-a.offer)/a.price*100):null;return e.createElement("div",null,e.createElement("div",{className:"flex items-center gap-3 mb-2"},e.createElement("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-[var(--color-text)]"},a.name),l&&e.createElement("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-bold bg-[var(--color-error)] text-[var(--color-background)] shadow-lg"},"-",l,"%")),e.createElement("div",{className:"flex items-center justify-between mb-4"},e.createElement("div",{className:"flex flex-col"},e.createElement("div",{className:"text-2xl sm:text-3xl font-bold text-[var(--color-main)]"},i," EGP"),l&&e.createElement("div",{className:"text-lg text-[var(--color-text-light)] line-through"},a.price," EGP")),o&&d&&e.createElement("div",{className:`text-sm font-medium px-3 py-1 rounded-full ${s()>=6?"bg-[var(--color-success)]/10 text-[var(--color-success)]":s()>0?"bg-[var(--color-warning)]/10 text-[var(--color-warning)]":"bg-[var(--color-error)]/10 text-[var(--color-error)]"}`},s()>=6?"In Stock":s()>0?`Low Stock (${s()})`:"Out of Stock")),e.createElement("p",{className:"text-[var(--color-text-light)] text-base sm:text-lg leading-relaxed mb-6"},a.description))},M=({selectedColor:a,setSelectedColor:o,selectedSize:d,setSelectedSize:s,getAvailableColors:r,getAvailableSizes:i,setQuantity:l})=>e.createElement("div",{className:"space-y-6"},r().length>0&&e.createElement("div",{className:"space-y-3 mb-6"},e.createElement("h3",{className:"font-semibold text-[var(--color-text)] text-lg"},"Color"),e.createElement("div",{className:"flex flex-wrap gap-2"},r().map(c=>e.createElement("button",{key:c,onClick:()=>{o(c),s(""),l(1)},className:`px-4 py-2 rounded-xl border transition-all ${a===c?"border-[var(--color-main)] bg-[var(--color-main)]/10 text-[var(--color-main)] font-medium":"border-[var(--color-border)] hover:border-[var(--color-main-light)] text-[var(--color-text)]"}`},c)))),a&&i().length>0&&e.createElement("div",{className:"space-y-3 mb-6"},e.createElement("h3",{className:"font-semibold text-[var(--color-text)] text-lg"},"Size"),e.createElement("div",{className:"flex flex-wrap gap-2"},i().map(c=>e.createElement("button",{key:c,onClick:()=>{s(c),l(1)},className:`px-4 py-2 rounded-xl border transition-all flex items-center justify-center min-w-[80px] ${d===c?"border-[var(--color-main)] bg-[var(--color-main)]/10 text-[var(--color-main)] font-medium":"border-[var(--color-border)] hover:border-[var(--color-main-light)] text-[var(--color-text)]"}`,title:"available"},e.createElement("span",null,c)))))),ee=({product:a,quantity:o,setQuantity:d,selectedColor:s,selectedSize:r,getAvailableQuantity:i,handleAddToCart:l})=>{const c=p=>{const u=o+p,w=i();u>=1&&u<=w&&d(u)};return e.createElement("div",{className:"space-y-6"},s&&r&&e.createElement("div",{className:"space-y-3 mb-6"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("h3",{className:"font-semibold text-[var(--color-text)] text-lg"},"Quantity")),e.createElement("div",{className:"flex items-center space-x-4"},e.createElement("div",{className:"flex items-center border border-[var(--color-border)] rounded-xl overflow-hidden"},e.createElement("button",{onClick:()=>c(-1),disabled:o<=1,className:"p-3 hover:bg-[var(--color-hover)] disabled:opacity-50 disabled:cursor-not-allowed text-[var(--color-text)] transition-colors"},e.createElement(V,{size:16})),e.createElement("span",{className:"px-4 py-2 min-w-[60px] text-center font-medium text-[var(--color-text)]"},o),e.createElement("button",{onClick:()=>c(1),disabled:o>=i(),className:"p-3 hover:bg-[var(--color-hover)] disabled:opacity-50 disabled:cursor-not-allowed text-[var(--color-text)] transition-colors"},e.createElement(J,{size:16}))))),e.createElement("div",{className:"space-y-4 mb-8"},e.createElement(D,{onClick:l,disabled:!s||!r||i()===0||o>i(),className:"w-full py-4 text-lg font-medium rounded-xl",size:"large"},e.createElement(U,{size:22,className:"mr-2"}),o>i()?"Not enough stock":i()===0?"Out of Stock":"Add to Cart")))},te=({product:a,getAvailableColors:o})=>e.createElement("div",{className:"border-t border-[var(--color-border)] pt-6 space-y-4"},e.createElement("h3",{className:"font-semibold text-[var(--color-text)] text-lg"},"Product Details"),e.createElement("div",{className:"flex justify-between py-2"},e.createElement("span",{className:"text-[var(--color-text-light)]"},"Category:"),e.createElement("span",{className:"font-medium text-[var(--color-text)] capitalize"},a.category)),e.createElement("div",{className:"flex justify-between py-2"},e.createElement("span",{className:"text-[var(--color-text-light)]"},"Gender:"),e.createElement("span",{className:"font-medium text-[var(--color-text)] capitalize"},a.gender)),e.createElement("div",{className:"flex justify-between py-2"},e.createElement("span",{className:"text-[var(--color-text-light)]"},"Available Colors:"),e.createElement("span",{className:"font-medium text-[var(--color-text)]"},o().join(", ")))),ce=({setNoteMessage:a})=>{const{id:o}=H(),d=Y(),s=q(),[r,i]=f.useState(null),[l,c]=f.useState(null),[p,u]=f.useState([]),[w,z]=f.useState(!0),[m,I]=f.useState(""),[x,k]=f.useState(""),[h,S]=f.useState(1),[L,$]=f.useState(0);f.useEffect(()=>{F()},[o]);const O=()=>{const t=`${window.location.origin}${s.pathname}`;navigator.share?navigator.share({title:r?.name,text:r?.description,url:t}):(navigator.clipboard.writeText(t),v(a,"Link copied to clipboard!",!0))},F=async()=>{try{z(!0);const t=Z(o);if(!t||t.length!==24){v(a,"Invalid product ID",!1),d("/");return}const n=await X(t);i(n.data),u(n.relatedProducts||[]),c(n.data.variants||[]);const g=n.data.variants||[];if(g&&g.length>0){const E=[...new Set(g.map(b=>b.color))];E.length>0&&I(E[0])}}catch(t){v(a,t?.response?.data?.message||"Failed to load product",!1),d("/")}finally{z(!1)}};f.useEffect(()=>{if(l&&m){const t=l.filter(n=>n.color===m&&n.stock>0).map(n=>n.size);t.length>0?k(t[0]):k(""),S(1)}},[m,l]);const P=()=>l?[...new Set(l.filter(t=>t.stock>0).map(t=>t.color))]:[],G=()=>!l||!m?[]:l.filter(t=>t.color===m&&t.stock>0).map(t=>t.size),N=()=>{if(!l||!m||!x)return 0;const t=l.find(n=>n.color===m&&n.size===x);return t?t.stock:0},R=()=>!l||!m||!x?null:l.find(t=>t.color===m&&t.size===x),T=()=>{if(!m||!x){v(a,"Please select color and size",!1);return}const t=N();if(t<=0){v(a,`This ${m} ${x} combination is out of stock`,!1);return}if(h>t){v(a,`Only ${t} items available in stock for this variant`,!1);return}try{const n=JSON.parse(localStorage.getItem("cart")||"[]"),g=R();if(!g){v(a,"Selected variant not found",!1);return}const E=n.findIndex(b=>b.variantId===g._id);if(E>-1){const y=n[E].quantity+h,j=t;if(y>j){v(a,`Cannot add more items. Only ${j} available in stock for this variant`,!1);return}n[E].quantity=y}else{const b=C(r.price,r.offer,r.offerStartDate,r.offerEndDate)?r.offer:r.price,y={productId:r._id,variantId:g._id,name:r.name,image:r.images[0],color:m,size:x,quantity:h,price:b,originalPrice:r.price,stock:g.stock};n.push(y)}localStorage.setItem("cart",JSON.stringify(n)),window.dispatchEvent(new CustomEvent("cartUpdated")),v(a,"Product added to cart successfully!",!0)}catch{v(a,"Failed to add to cart",!1)}};return w?e.createElement(K,{text:"Loading product..."}):r?e.createElement("div",{className:"min-h-screen"},e.createElement("div",{className:"container mx-auto px-4 py-6"},e.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12"},e.createElement(A,{product:r,currentImageIndex:L,setCurrentImageIndex:$}),e.createElement("div",{className:"space-y-6"},e.createElement("div",{className:"space-y-4"},e.createElement("div",{className:"flex items-start justify-between"},e.createElement("div",{className:"flex-1"},e.createElement(Q,{product:r,selectedColor:m,selectedSize:x,getAvailableQuantity:N})),e.createElement("button",{onClick:O,className:"flex items-center space-x-2 text-[var(--color-text)] hover:text-[var(--color-main)] transition-colors p-2 rounded-lg hover:bg-[var(--color-hover)] ml-4 flex-shrink-0"},e.createElement(W,{size:20}),e.createElement("span",{className:"hidden sm:inline"},"Share")))),e.createElement(M,{selectedColor:m,setSelectedColor:I,selectedSize:x,setSelectedSize:k,getAvailableColors:P,getAvailableSizes:G,setQuantity:S,getAvailableQuantity:N}),e.createElement(ee,{product:r,quantity:h,setQuantity:S,selectedColor:m,selectedSize:x,getAvailableQuantity:N,handleAddToCart:T}),e.createElement(te,{product:r,getAvailableColors:P}))),p&&p.length>0&&e.createElement("div",{className:"mt-16"},e.createElement("div",{className:"text-center mb-8"},e.createElement("h2",{className:"text-2xl font-bold text-[var(--color-text)] mb-2"},"You May Also Like"),e.createElement("p",{className:"text-[var(--color-text-light)]"},"Discover more products in this category")),e.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6"},p.map(t=>{const n=C(t.price,t.offer,t.offerStartDate,t.offerEndDate);return e.createElement("div",{key:t._id,className:"group relative rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 ease-out transform hover:scale-[1.02] border border-[var(--color-border)] cursor-pointer",onClick:()=>d(`/product/${t._id}`)},e.createElement("div",{className:"aspect-square overflow-hidden bg-[var(--color-border)]"},t.images&&t.images.length>0?e.createElement("img",{src:t.images[0],alt:t.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"}):e.createElement("div",{className:"w-full h-full flex items-center justify-center text-[var(--color-text-light)]"},"No Image")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"font-semibold text-[var(--color-text)] text-sm mb-2 line-clamp-2 group-hover:text-[var(--color-main)] transition-colors"},t.name),e.createElement("div",{className:"flex items-center space-x-2"},n?e.createElement(e.Fragment,null,e.createElement("span",{className:"text-lg font-bold text-[var(--color-main)]"},t.offer," EGP"),e.createElement("span",{className:"text-sm text-[var(--color-text-light)] line-through"},t.price," EGP")):e.createElement("span",{className:"text-lg font-bold text-[var(--color-text)]"},t.price," EGP")),n&&e.createElement("div",{className:"mt-2"},e.createElement("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-[var(--color-main)] text-white"},"Offer"))))}))))):e.createElement("div",{className:"min-h-screen flex items-center justify-center"},e.createElement("div",{className:"text-center p-8 rounded-xl bg-[var(--color-surface)] shadow-lg"},e.createElement("h2",{className:"text-2xl font-bold text-[var(--color-text)] mb-4"},"Product not found"),e.createElement(D,{onClick:()=>d("/")},"Go Back Home")))};export{ce as default};
