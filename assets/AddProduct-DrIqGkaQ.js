import{A as D,r as y,R as e,j as P,B as w,a7 as S,a5 as C,F as k,u as U,l as z,o as F,x as I,s as L,w as A,a8 as j,a9 as R}from"./index-Py7kvHa0.js";import{a as G,u as O,c as $,r as V}from"./products-DZsIXrs4.js";import{s as m}from"./toastHelper-Cmf0APRO.js";const q=async a=>{console.log("Starting image upload...",a.name);const d=new FormData;d.append("image",a);try{const s=await D.post("/images/upload-single",d,{headers:{"Content-Type":"multipart/form-data"}});return console.log("Upload successful:",s.data),s.data}catch(s){throw console.error("Upload failed:",s),s}},T=async(a,d)=>{const s=[],c=[],u=a.filter(p=>typeof p=="string"),x=a.filter(p=>typeof p=="object"&&p.file);s.push(...u);for(const p of x){const E=q(p.file).then(t=>t.data.url).catch(t=>{throw new Error(`Failed to upload ${p.name}: ${t?.response?.data?.message||t.message}`)});c.push(E)}try{const p=await Promise.all(c);return s.push(...p),m(d,`Successfully uploaded ${x.length} images`,!0),s}catch(p){throw m(d,p.message||"Failed to upload images",!1),p}},B=a=>{a.forEach(d=>{typeof d=="object"&&d.previewUrl&&URL.revokeObjectURL(d.previewUrl)})},W=({variants:a,setVariants:d,setNoteMessage:s})=>{const[c,u]=y.useState({color:"",size:"",stock:0}),x=["XS","S","M","L","XL","AGE 2","AGE 4","AGE 6","AGE 8","AGE 10","AGE 12","AGE 14","AGE 16"],p=l=>{if(l.preventDefault(),!c.color.trim()){m(s,"Please enter a color",!1);return}if(!c.size){m(s,"Please select a size",!1);return}if(c.stock<0){m(s,"Stock cannot be negative",!1);return}if(a.some(g=>g.color.toLowerCase()===c.color.toLowerCase()&&g.size.toUpperCase()===c.size.toUpperCase()))m(s,"This color-size combination already exists!",!1);else{const g={color:c.color.toLowerCase().trim(),size:c.size.toUpperCase(),stock:parseInt(c.stock)||0},h=[...a,g];d(h),u({color:"",size:"",stock:0})}},E=l=>{d(a.filter((v,g)=>g!==l))},t=(l,v,g)=>{const h=[...a];h[l][v]=g,d(h)};return e.createElement("div",{className:"space-y-6"},e.createElement("div",{className:"space-y-4"},e.createElement("h4",{className:"text-lg font-semibold text-[var(--color-text)]"},"Add New Variant"),e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 items-end"},e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-1"},"Color"),e.createElement("input",{type:"text",value:c.color,onChange:l=>{u({...c,color:l.target.value})},className:"w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-[var(--color-text)]",placeholder:"e.g., red, blue",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-1"},"Size"),e.createElement("select",{value:c.size,onChange:l=>{u({...c,size:l.target.value})},className:"w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-background)] text-[var(--color-text)]",required:!0},e.createElement("option",{value:""},"Select Size"),x.map(l=>e.createElement("option",{key:l,value:l},l)))),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-1"},"Quantity"),e.createElement("input",{type:"number",min:"0",value:c.stock,onChange:l=>{u({...c,stock:parseInt(l.target.value)||0})},className:"w-full px-3 py-2 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-[var(--color-text)]",placeholder:"0",required:!0})),e.createElement("div",null,e.createElement("button",{type:"button",onClick:p,className:"w-full bg-[var(--color-main)] text-[var(--color-background)] py-2 px-4 rounded-lg hover:bg-[var(--color-main-dark)] transition-colors flex items-center justify-center space-x-2 font-medium"},e.createElement(P,{size:16}),e.createElement("span",null,"Add"))))),e.createElement("div",{className:"space-y-4"},e.createElement("h4",{className:"text-lg font-semibold text-[var(--color-text)]"},"Current Variants"),a.length===0?e.createElement("p",{className:"text-[var(--color-text-light)] text-sm italic"},"No variants have been added yet."):e.createElement("div",{className:"space-y-3"},a.map((l,v)=>e.createElement("div",{key:v,className:"flex items-center space-x-4 bg-[var(--color-input-bg)] p-3 rounded-lg border border-[var(--color-border)] shadow-sm"},e.createElement("div",{className:"flex-1 min-w-0"},e.createElement("span",{className:"font-medium text-[var(--color-text)] truncate block"},l.color," - ",l.size)),e.createElement("div",{className:"flex items-center space-x-2"},e.createElement("input",{type:"number",min:"0",value:l.stock,onChange:g=>t(v,"stock",parseInt(g.target.value)||0),className:"w-20 px-2 py-1 border border-[var(--color-border)] rounded focus:outline-none focus:ring-1 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-sm text-[var(--color-text)]"}),e.createElement("button",{onClick:()=>E(v),className:"p-2 text-[var(--color-error)] hover:bg-[var(--color-stock-low-bg)] rounded-lg transition-colors",title:"Remove variant"},e.createElement(w,{size:16}))))))),a.length>0&&e.createElement("div",{className:"bg-[var(--color-main)]/10 p-4 rounded-lg border border-[var(--color-main)]/20 shadow-sm"},e.createElement("p",{className:"text-sm text-[var(--color-text)]"},e.createElement("span",{className:"font-semibold"},"Total Variants:")," ",a.length," |",e.createElement("span",{className:"font-semibold ml-4"},"Total Stock:")," ",a.reduce((l,v)=>l+v.stock,0))))},X=({images:a=[],onImagesChange:d,maxImages:s=5,disabled:c=!1,setNoteMessage:u})=>{const[x,p]=y.useState(null),E=y.useRef(null),t=f=>{const o=Array.from(f.target.files);if(o.length>0){const r=[];let i=a.length;for(const n of o){if(i>=s){m(u,`Maximum ${s} images allowed`,!1);break}if(!n.type.startsWith("image/")){m(u,`${n.name} is not a valid image file`,!1);continue}if(n.size>5*1024*1024){m(u,`${n.name} is too large (max 5MB)`,!1);continue}const b=URL.createObjectURL(n),N={file:n,previewUrl:b,name:n.name,size:n.size,type:n.type};r.push(N),i++}if(r.length>0){const n=[...a,...r];d(n),m(u,`${r.length} image(s) selected successfully`,!0)}}f.target.value=""},l=f=>{f.preventDefault();const o=Array.from(f.dataTransfer.files);if(o.length>0){const r=[];let i=a.length;for(const n of o){if(i>=s){m(u,`Maximum ${s} images allowed`,!1);break}if(!n.type.startsWith("image/")){m(u,`${n.name} is not a valid image file`,!1);continue}if(n.size>5*1024*1024){m(u,`${n.name} is too large (max 5MB)`,!1);continue}const b=URL.createObjectURL(n),N={file:n,previewUrl:b,name:n.name,size:n.size,type:n.type};r.push(N),i++}if(r.length>0){const n=[...a,...r];d(n),m(u,`${r.length} image(s) selected successfully`,!0)}}},v=f=>{f.preventDefault()},g=f=>{if(window.confirm("Are you sure you want to remove this image?")){const o=a[f];o.previewUrl&&URL.revokeObjectURL(o.previewUrl);const r=a.filter((i,n)=>n!==f);d(r),m(u,"Image removed successfully",!0)}},h=f=>{p(f)};return e.createElement("div",{className:"space-y-4"},a.length<s&&!c&&e.createElement("div",{className:"border-2 border-dashed border-[var(--color-border)] rounded-lg p-6 text-center hover:border-[var(--color-main)] transition-colors cursor-pointer",onDrop:l,onDragOver:v,onClick:()=>E.current?.click()},e.createElement(S,{className:"mx-auto text-3xl text-[var(--color-text-light)] mb-2"}),e.createElement("p",{className:"text-[var(--color-text)] mb-1"},"Click to select or drag and drop images"),e.createElement("p",{className:"text-sm text-[var(--color-text-light)]"},"PNG, JPG, WEBP up to 5MB"),e.createElement("input",{ref:E,type:"file",accept:"image/*",onChange:t,className:"hidden",multiple:!0})),a.length>0&&e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},a.map((f,o)=>{const r=typeof f=="string"?f:f.previewUrl,i=typeof f=="object"&&f.file;return e.createElement("div",{key:o,className:"relative group"},e.createElement("div",{className:"aspect-square rounded-lg overflow-hidden border border-[var(--color-border)] bg-[var(--color-surface)]"},e.createElement("img",{src:r,alt:`Product image ${o+1}`,className:"w-full h-full object-cover"})),i&&e.createElement("div",{className:"absolute top-2 left-2 bg-[var(--color-main)] text-[var(--color-background)] text-xs px-2 py-1 rounded"},"Local"),!c&&e.createElement("div",{className:"absolute inset-0 bg-blur bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center space-x-2"},e.createElement("button",{onClick:()=>h(r),className:"p-2 bg-[var(--color-background)] rounded-full text-[var(--color-text)] hover:bg-[var(--color-hover)] transition-colors",title:"Preview image"},e.createElement(C,{size:16})),e.createElement("button",{onClick:()=>g(o),className:"p-2 bg-[var(--color-error)] rounded-full text-[var(--color-background)] hover:bg-[var(--color-error)]/80 transition-colors",title:"Remove image"},e.createElement(w,{size:16}))))})),e.createElement("div",{className:"text-sm text-[var(--color-text-light)] text-center"},a.length," of ",s," images selected"),x&&e.createElement("div",{className:"fixed inset-0 bg-blur flex items-center justify-center z-50 p-4"},e.createElement("div",{className:"relative max-w-4xl max-h-full"},e.createElement("button",{onClick:()=>p(null),className:"absolute top-4 right-4 p-2 bg-[var(--color-background)] rounded-full text-[var(--color-text)] hover:bg-[var(--color-hover)] transition-colors z-10"},e.createElement(k,{size:24})),e.createElement("img",{src:x,alt:"Preview",className:"max-w-full max-h-full object-contain rounded-lg"}))))},Q=({setNoteMessage:a})=>{const d=U(),{id:s}=z(),c=!!s,[u,x]=y.useState(!1),[p,E]=y.useState(c),[t,l]=y.useState({name:"",price:"",offer:"",offerStartDate:"",offerEndDate:"",description:"",category:"",gender:"",images:[]}),[v,g]=y.useState([]);y.useEffect(()=>{c&&(async()=>{try{E(!0);const i=(await G(s)).data;l({name:i.name||"",price:i.price||"",offer:i.offer||"",offerStartDate:i.offerStartDate?new Date(i.offerStartDate).toISOString().slice(0,16):"",offerEndDate:i.offerEndDate?new Date(i.offerEndDate).toISOString().slice(0,16):"",description:i.description||"",category:i.category||"",gender:i.gender||"",images:i.images||[]}),g(i.variants||[])}catch{m(a,"Failed to load product data",!1),d("/admin/dashboard/products")}finally{E(!1)}})()},[s,c,d,a]);const h=async o=>{o.preventDefault(),x(!0);try{if(!t.name||!t.price||!t.description||!t.category||!t.gender||v.length===0||t.images.length===0){let b=[];t.name||b.push("Product Name"),t.price||b.push("Price"),t.description||b.push("Description"),t.category||b.push("Category"),t.gender||b.push("Gender"),v.length===0&&b.push("At least one variant (color, size, quantity)"),t.images.length===0&&b.push("At least one image"),m(a,`Please fill in all required fields: ${b.join(", ")}`,!1),x(!1);return}m(a,"Uploading images...",!0);const r=await T(t.images,a),i=v.reduce((b,N)=>b+N.stock,0),n={...t,price:parseFloat(t.price),offer:t.offer?parseFloat(t.offer):void 0,offerStartDate:t.offerStartDate||void 0,offerEndDate:t.offerEndDate||void 0,stock:i,images:r,variants:v};c?(await O(s,n),m(a,"Product updated successfully",!0)):(await $(n),m(a,"Product created successfully",!0)),B(t.images),d("/admin/dashboard/products")}catch(r){console.error("Product submission error:",r),m(a,r?.response?.data?.message||r.message||`Failed to ${c?"update":"save"} product`,!1)}finally{x(!1)}},f=async()=>{if(c&&window.confirm("Are you sure you want to remove the offer from this product?"))try{x(!0);const o=await V(s);m(a,o.message,!0),l(r=>({...r,offer:"",offerStartDate:"",offerEndDate:""}))}catch(o){m(a,o?.response?.data?.message||"Failed to remove offer",!1)}finally{x(!1)}};return p?e.createElement("div",{className:"h-screen bg-gradient-to-br from-[var(--color-background)] to-[var(--color-surface)] flex items-center justify-center"},e.createElement("div",{className:"text-center"},e.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--color-main)] mx-auto mb-4"}),e.createElement("p",{className:"text-[var(--color-text)]"},"Loading product data..."))):e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-[var(--color-background)] to-[var(--color-surface)] overflow-hidden"},e.createElement("div",{className:"h-16 bg-[var(--color-surface)] border-b border-[var(--color-border)] flex items-center justify-between px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16 2xl:px-24"},e.createElement("div",{className:"flex items-center space-x-2 sm:space-x-4"},e.createElement("button",{onClick:()=>d("/admin/dashboard/products"),className:"flex items-center space-x-1 sm:space-x-2 text-[var(--color-text)] hover:text-[var(--color-main)] transition-colors rounded-md py-1 px-2 -ml-2 sm:ml-0"},e.createElement(F,{className:"text-xl sm:text-2xl"}))),e.createElement("h1",{className:"text-base sm:text-xl font-bold text-[var(--color-text)] text-center absolute left-1/2 transform -translate-x-1/2"},c?"Edit Product":"Add New Product"),e.createElement("div",{className:"w-auto sm:w-32"})),e.createElement("div",{className:"p-4 sm:p-6 lg:p-10"},e.createElement("div",{className:"max-w-7xl mx-auto"},e.createElement("form",{onSubmit:h,className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8"},e.createElement("div",{className:"lg:col-span-1 space-y-6"},e.createElement("div",{className:"bg-[var(--color-surface)] rounded-xl p-6 border border-[var(--color-border)] shadow-sm"},e.createElement("h3",{className:"text-xl font-bold text-[var(--color-text)] mb-5 flex items-center"},e.createElement(I,{className:"mr-3 text-[var(--color-main)]",size:20}),"Basic Information"),e.createElement("div",{className:"space-y-5"},e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-2"},"Product Name ",e.createElement("span",{className:"text-[var(--color-error)]"},"*")),e.createElement("input",{type:"text",value:t.name,onChange:o=>l(r=>({...r,name:o.target.value})),className:"w-full px-4 py-2.5 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-[var(--color-text)] placeholder:text-[var(--color-text-light)] transition-colors",placeholder:"Enter product name",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-2"},"Price (EGP) ",e.createElement("span",{className:"text-[var(--color-error)]"},"*")),e.createElement("input",{type:"number",step:"0.01",value:t.price,onChange:o=>l(r=>({...r,price:o.target.value})),className:"w-full px-4 py-2.5 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-[var(--color-text)] placeholder:text-[var(--color-text-light)] transition-colors",placeholder:"Enter price",required:!0})),e.createElement("div",null,e.createElement("div",{className:"flex items-center justify-between mb-2"},e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)]"},"Offer Price (EGP)"),c&&t.offer&&e.createElement("button",{type:"button",onClick:f,disabled:u,className:"p-1 rounded text-[var(--color-error)] hover:bg-[var(--color-error)]/10 transition-colors",title:"Remove offer"},e.createElement(k,{size:14}))),e.createElement("input",{type:"number",step:"0.01",value:t.offer,onChange:o=>l(r=>({...r,offer:o.target.value})),className:"w-full px-4 py-2.5 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-[var(--color-text)] placeholder:text-[var(--color-text-light)] transition-colors",placeholder:"Enter offer price (optional)"}),t.offer&&t.price&&parseFloat(t.offer)>=parseFloat(t.price)&&e.createElement("p",{className:"text-sm text-[var(--color-error)] mt-1"},"Offer price must be less than regular price")),t.offer&&e.createElement(e.Fragment,null,e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-2"},"Offer Start Date"),e.createElement("input",{type:"datetime-local",value:t.offerStartDate,onChange:o=>l(r=>({...r,offerStartDate:o.target.value})),className:"w-full px-4 py-2.5 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-[var(--color-text)] placeholder:text-[var(--color-text-light)] transition-colors"})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-2"},"Offer End Date"),e.createElement("input",{type:"datetime-local",value:t.offerEndDate,onChange:o=>l(r=>({...r,offerEndDate:o.target.value})),className:"w-full px-4 py-2.5 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-[var(--color-text)] placeholder:text-[var(--color-text-light)] transition-colors"}),t.offerStartDate&&t.offerEndDate&&new Date(t.offerStartDate)>=new Date(t.offerEndDate)&&e.createElement("p",{className:"text-sm text-[var(--color-error)] mt-1"},"End date must be after start date"))),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-2"},"Description ",e.createElement("span",{className:"text-[var(--color-error)]"},"*")),e.createElement("textarea",{value:t.description,onChange:o=>l(r=>({...r,description:o.target.value})),className:"w-full px-4 py-2.5 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-input-bg)] text-[var(--color-text)] placeholder:text-[var(--color-text-light)] transition-colors",rows:"4",placeholder:"Enter product description",required:!0})))),e.createElement("div",{className:"bg-[var(--color-surface)] rounded-xl p-6 border border-[var(--color-border)] shadow-sm"},e.createElement("h3",{className:"text-xl font-bold text-[var(--color-text)] mb-5 flex items-center"},e.createElement(L,{className:"mr-3 text-[var(--color-main)]",size:20}),"Category & Gender"),e.createElement("div",{className:"space-y-5"},e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-2"},"Category ",e.createElement("span",{className:"text-[var(--color-error)]"},"*")),e.createElement("select",{value:t.category,onChange:o=>l(r=>({...r,category:o.target.value})),className:"w-full px-4 py-2.5 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-background)] text-[var(--color-text)] transition-colors",required:!0},e.createElement("option",{value:""},"Select Category"),e.createElement("option",{value:"dresses"},"Dresses"),e.createElement("option",{value:"hoodies"},"Hoodies"),e.createElement("option",{value:"jackets"},"Jackets"),e.createElement("option",{value:"pants"},"Pants"),e.createElement("option",{value:"shirts"},"Shirts"),e.createElement("option",{value:"shoes"},"Shoes"),e.createElement("option",{value:"shorts"},"Shorts"),e.createElement("option",{value:"tops"},"Tops"),e.createElement("option",{value:"tshirts"},"T-shirts"))),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-2"},"Gender ",e.createElement("span",{className:"text-[var(--color-error)]"},"*")),e.createElement("select",{value:t.gender,onChange:o=>l(r=>({...r,gender:o.target.value})),className:"w-full px-4 py-2.5 border border-[var(--color-border)] rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--color-main)] bg-[var(--color-background)] text-[var(--color-text)] transition-colors",required:!0},e.createElement("option",{value:""},"Select Gender"),e.createElement("option",{value:"male"},"Male"),e.createElement("option",{value:"female"},"Female"),e.createElement("option",{value:"unisex"},"Unisex")))))),e.createElement("div",{className:"lg:col-span-2 space-y-6"},e.createElement("div",{className:"bg-[var(--color-surface)] rounded-xl p-6 border border-[var(--color-border)] shadow-sm"},e.createElement("h3",{className:"text-xl font-bold text-[var(--color-text)] mb-5 flex items-center"},e.createElement(A,{className:"mr-3 text-[var(--color-main)]",size:20}),"Product Images"),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-[var(--color-text)] mb-2"},"Upload Images ",e.createElement("span",{className:"text-[var(--color-error)]"},"*")),e.createElement(X,{images:t.images,onImagesChange:o=>l(r=>({...r,images:o})),maxImages:5,setNoteMessage:a}))),e.createElement("div",{className:"bg-[var(--color-surface)] rounded-xl p-6 border border-[var(--color-border)] shadow-sm"},e.createElement("h3",{className:"text-xl font-bold text-[var(--color-text)] mb-5 flex items-center"},e.createElement(j,{className:"mr-3 text-[var(--color-main)]",size:20}),"Product Variants"),e.createElement(W,{variants:v,setVariants:g,setNoteMessage:a})),e.createElement("button",{type:"submit",onClick:h,disabled:u,className:"flex-1 flex items-center w-full justify-center space-x-2 px-6 py-3 bg-[var(--color-main)] text-[var(--color-background)] rounded-lg hover:bg-[var(--color-main-dark)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium"},e.createElement(R,{size:18}),e.createElement("span",null,u?c?"Updating...":"Creating...":c?"Update Product":"Create Product")))))))};export{Q as default};
